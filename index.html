<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Experimental calendar search</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,shrink-to-fit=no"
    />
    <meta
      name="description"
      content="Search for years in which a given date in the Islamic calendar fell on a given weekday"
    />
    <meta content="Theo Beers" name="author" />
    <meta property="og:title" content="Experimental calendar search" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://www.theobeers.com/calendar-search/"
    />
    <meta
      property="og:image"
      content="https://www.theobeers.com/calendar-search/img/astrolog.jpg"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="icon" href="#" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <style>
      body {
        max-width: 860px;
        margin: auto;
      }
      h1 {
        font-size: 210%;
      }
      h5 {
        font-size: 115%;
      }
      p,
      li {
        hyphens: auto;
      }
    </style>
  </head>
  <body>
    <div class="container" style="margin-top: 0.6rem; margin-bottom: 1.5rem">
      <h1>Experimental calendar search</h1>
      <div style="display: none">
        <form
          action="JavaScript:calcGregorian();"
          id="gregorian"
          name="gregorian"
        >
          <table>
            <tr>
              <td>
                <input
                  aria-label="Gregorian year"
                  id="greg-year"
                  name="year"
                  type="number"
                  value="1998"
                />
                <select aria-label="Gregorian month" name="month">
                  <option value="1">January</option>
                  <option value="2">February</option>
                  <option value="3">March</option>
                  <option value="4">April</option>
                  <option value="5">May</option>
                  <option value="6">June</option>
                  <option value="7">July</option>
                  <option value="8">August</option>
                  <option value="9">September</option>
                  <option value="10">October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
                </select>
                <input
                  aria-label="Gregorian day"
                  id="greg-day"
                  max="31"
                  min="1"
                  name="day"
                  type="number"
                  value="1"
                /><br /><input
                  aria-label="Normal or leap year"
                  name="leap"
                  readonly="readonly"
                  type="text"
                  value=""
                />
                <input
                  aria-label="Weekday"
                  name="wday"
                  readonly="readonly"
                  type="text"
                  value=""
                />
              </td>
            </tr>
            <tr>
              <td>
                <input
                  id="greg-calc-btn"
                  onclick="calcGregorian();"
                  type="submit"
                  value="Calculate"
                />
                &ensp;
                <input
                  id="greg-today-btn"
                  onclick="setDateToToday();calcGregorian();"
                  type="button"
                  value="Today"
                />
              </td>
            </tr>
          </table>
        </form>
        <form
          action="JavaScript:calcJulianCalendar();"
          id="juliancalendar"
          name="juliancalendar"
        >
          <table>
            <tr>
              <td>
                <input
                  aria-label="Julian year"
                  id="julian-year"
                  name="year"
                  type="number"
                  value=""
                />
                <select aria-label="Julian month" name="month">
                  <option value="1">January</option>
                  <option value="2">February</option>
                  <option value="3">March</option>
                  <option value="4">April</option>
                  <option value="5">May</option>
                  <option value="6">June</option>
                  <option value="7">July</option>
                  <option value="8">August</option>
                  <option value="9">September</option>
                  <option value="10">October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
                </select>
                <input
                  aria-label="Julian day"
                  id="julian-cal-day"
                  max="31"
                  min="1"
                  name="day"
                  type="number"
                  value=""
                /><br /><input
                  aria-label="Normal or leap year"
                  name="leap"
                  readonly="readonly"
                  type="text"
                  value=""
                />
                <input
                  aria-label="Weekday"
                  name="wday"
                  readonly="readonly"
                  type="text"
                  value=""
                />
              </td>
            </tr>
            <tr>
              <td>
                <input
                  id="julian-btn"
                  onclick="calcJulianCalendar();"
                  type="submit"
                  value="Calculate"
                />
              </td>
            </tr>
          </table>
        </form>
        <form action="JavaScript:calcHebrew();" id="hebrew" name="hebrew">
          <table>
            <tr>
              <td>
                <input
                  aria-label="Hebrew year"
                  name="year"
                  id="heb-year"
                  type="number"
                  value=""
                />
                <select name="month" aria-label="Hebrew month">
                  <option label="Nisan" value="1"></option>
                  <option label="Iyar" value="2"></option>
                  <option label="Sivan" value="3"></option>
                  <option label="Tammuz" value="4"></option>
                  <option label="Av" value="5"></option>
                  <option label="Elul" value="6"></option>
                  <option label="Tishrei" value="7"></option>
                  <option label="Cheshvan" value="8"></option>
                  <option label="Kislev" value="9"></option>
                  <option label="Tevet" value="10"></option>
                  <option label="Shevat" value="11"></option>
                  <option label="Adar" value="12"></option>
                  <option label="Veadar" value="13"></option>
                </select>
                <input
                  aria-label="Hebrew day"
                  name="day"
                  max="30"
                  min="1"
                  type="number"
                  value=""
                /><br /><input
                  aria-label="Type of year"
                  name="leap"
                  readonly="readonly"
                  type="text"
                  value=""
                />
              </td>
            </tr>
            <tr>
              <td>
                <input
                  onclick="calcHebrew();"
                  value="Calculate"
                  type="submit"
                  id="hebrew-btn"
                />
              </td>
            </tr>
          </table>
        </form>
        <form action="JavaScript:calcIslamic();" id="islamic" name="islamic">
          <table>
            <tr>
              <td>
                <input
                  aria-label="Islamic year"
                  id="islamic-year"
                  name="year"
                  type="number"
                  value=""
                />
                <select aria-label="Islamic month" name="month">
                  <option value="1">Muharram</option>
                  <option value="2">Safar</option>
                  <option value="3">Rabi‘ I</option>
                  <option value="4">Rabi‘ II</option>
                  <option value="5">Jumada I</option>
                  <option value="6">Jumada II</option>
                  <option value="7">Rajab</option>
                  <option value="8">Sha‘ban</option>
                  <option value="9">Ramadan</option>
                  <option value="10">Shawwal</option>
                  <option value="11">Dhu al-Qa‘dah</option>
                  <option value="12">Dhu al-Hijjah</option>
                </select>
                <input
                  aria-label="Islamic day"
                  id="islamic-day"
                  max="30"
                  min="1"
                  name="day"
                  type="number"
                  value=""
                /><br /><input
                  aria-label="Normal or leap year"
                  name="leap"
                  readonly="readonly"
                  type="text"
                  value=""
                />
                <input
                  aria-label="Arabic weekday"
                  name="wday"
                  readonly="readonly"
                  type="text"
                  value=""
                />
              </td>
            </tr>
            <tr>
              <td>
                <input
                  id="islamic-btn"
                  onclick="calcIslamic();"
                  type="submit"
                  value="Calculate"
                />
              </td>
            </tr>
          </table>
        </form>
        <form action="JavaScript:calcPersiana();" id="persiana" name="persiana">
          <table>
            <tr>
              <td>
                <input
                  aria-label="Persian year"
                  id="pers-year"
                  name="year"
                  type="number"
                  value=""
                />
                <select aria-label="Persian month" name="month">
                  <option value="1">Farvardin</option>
                  <option value="2">Ordibehesht</option>
                  <option value="3">Khordad</option>
                  <option value="4">Tir</option>
                  <option value="5">Mordad</option>
                  <option value="6">Shahrivar</option>
                  <option value="7">Mehr</option>
                  <option value="8">Aban</option>
                  <option value="9">Azar</option>
                  <option value="10">Dey</option>
                  <option value="11">Bahman</option>
                  <option value="12">Esfand</option>
                </select>
                <input
                  aria-label="Persian day"
                  id="persian-day"
                  max="31"
                  min="1"
                  name="day"
                  type="number"
                  value=""
                /><br /><input
                  aria-label="Normal or leap year"
                  name="leap"
                  readonly="readonly"
                  type="text"
                  value=""
                />
                <input
                  aria-label="Persian weekday"
                  name="wday"
                  readonly="readonly"
                  type="text"
                  value=""
                />
              </td>
            </tr>
            <tr>
              <td>
                <input
                  id="pers-btn"
                  onclick="calcPersiana();"
                  type="submit"
                  value="Calculate"
                />
              </td>
            </tr>
          </table>
        </form>
      </div>
      <h5>For the following date in the Islamic calendar…</h5>
      <div class="form-group mb-2">
        <label for="new-select-month">Month</label>
        <select class="form-control" id="new-select-month" style="width: 10rem">
          <option value="1">Muharram</option>
          <option value="2">Safar</option>
          <option value="3">Rabi‘ I</option>
          <option value="4">Rabi‘ II</option>
          <option value="5">Jumada I</option>
          <option value="6">Jumada II</option>
          <option value="7">Rajab</option>
          <option value="8">Sha‘ban</option>
          <option value="9">Ramadan</option>
          <option value="10">Shawwal</option>
          <option value="11">Dhu al-Qa‘dah</option>
          <option value="12">Dhu al-Hijjah</option>
        </select>
      </div>
      <div class="form-group">
        <label for="new-select-day">Day (1–30)</label>
        <input
          type="number"
          class="form-control"
          id="new-select-day"
          max="30"
          min="1"
          value=""
          style="width: 5rem"
        />
      </div>
      <h5>In the following <em>inclusive</em> range of years (AH)…</h5>
      <div class="form-group mb-2">
        <label for="new-select-start-year">Start year (100–1400)</label>
        <input
          type="number"
          class="form-control"
          id="new-select-start-year"
          max="1400"
          min="100"
          value=""
          style="width: 6rem"
        />
      </div>
      <div class="form-group">
        <label for="new-select-end-year">End year (100–1400)</label>
        <input
          type="number"
          class="form-control"
          id="new-select-end-year"
          max="1400"
          min="100"
          value=""
          style="width: 6rem"
        />
      </div>
      <h5>
        Return years in which that date is calculated as occurring on the
        following day of the week…
      </h5>
      <div class="form-group">
        <label for="new-select-weekday">Weekday</label>
        <select
          class="form-control"
          id="new-select-weekday"
          style="width: 10rem"
        >
          <option>Saturday</option>
          <option>Sunday</option>
          <option>Monday</option>
          <option>Tuesday</option>
          <option>Wednesday</option>
          <option>Thursday</option>
          <option>Friday</option>
        </select>
      </div>
      <button
        type="button"
        class="btn btn-primary mb-1 mr-3"
        id="new-submit-button"
      >
        Submit</button
      ><button
        type="button"
        class="btn btn-secondary mb-1"
        id="new-reset-button"
      >
        Clear
      </button>
      <hr />
      <div class="card border-success" style="max-width: 24rem">
        <div class="card-body text-success">
          <h5 class="card-title">Results</h5>
          <p class="card-text" id="new-results-text">…</p>
        </div>
      </div>
      <hr />
      <h4>Caveats</h4>
      <ul class="list-group">
        <li class="list-group-item">
          This is based on standard algorithmic date calculation/conversion. It
          should be accurate, as far as such things go; but the user is advised
          to allow a margin of plus or minus one day, <em>particularly</em> with
          regard to the weekday associated with a given date. If, for example,
          you're looking for years in which 5 Rajab fell on a Thursday, you
          should probably run queries for Wednesday and Friday, as well.
        </li>
        <li class="list-group-item">
          Yes, the number of positive results will increase due to the margin of
          error. I'm not really sure how valuable this tool will be. But if
          you're working with a source that mentions a month, day, and weekday
          for an event, and you're trying to identify possible years from a
          range that isn't too large, it <em>can</em> be helpful to know which
          options fit best.
        </li>
        <li class="list-group-item">
          Please note that the difference between the start and end years cannot
          exceed 300. (Technically, since the range is treated inclusively, the
          maximum number of years that can be searched at once is 301.) I wanted
          to set some reasonable limit, due to the incredibly inefficient way in
          which the script has been implemented.
        </li>
      </ul>
    </div>
    <script src="js/jquery-3.5.1.slim.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/calendar.min.js"></script>
    <script>
      // Set current date on page load
      setDateToToday();

      // Not sure what this does
      if ("" === location.search) {
        calcGregorian();
      } else {
        presetDataToRequest(location.search.substring(1));
      }
    </script>
    <script>
      // Global consts for new DOM elements
      const newMonthField = document.getElementById("new-select-month");
      const newDayField = document.getElementById("new-select-day");
      const newStartYearField = document.getElementById(
        "new-select-start-year"
      );
      const newEndYearField = document.getElementById("new-select-end-year");
      const newWeekdayField = document.getElementById("new-select-weekday");
      const newSubmitButton = document.getElementById("new-submit-button");
      const newResetButton = document.getElementById("new-reset-button");
      const newResultsTextField = document.getElementById("new-results-text");

      // Function to search for matching years
      function experimentalSearch() {
        // Consts for submitted values
        const submittedMonthIndex = newMonthField.selectedIndex;
        const submittedDay = newDayField.value;
        const submittedStartYear = Number(newStartYearField.value);
        const submittedEndYear = Number(newEndYearField.value);
        const submittedWeekday = newWeekdayField.value;

        // Abort if any field has been left empty
        if (!submittedDay || !submittedStartYear || !submittedEndYear) {
          return;
        }

        // Abort if any submitted value is out of bounds
        if (
          submittedDay < 1 ||
          submittedDay > 30 ||
          submittedStartYear < 100 ||
          submittedStartYear > 1400 ||
          submittedEndYear < 100 ||
          submittedEndYear > 1400
        ) {
          newResultsTextField.innerText =
            "At least one submitted value was out of bounds!";
          return;
        }

        // Abort if start year is later than end year
        if (submittedStartYear > submittedEndYear) {
          newResultsTextField.innerText =
            "The start year is later than the end year…?";
          return;
        }

        // Limit year range to 300 (technically 301 inclusive)
        // Abort if this is bad
        if (submittedEndYear - submittedStartYear > 300) {
          newResultsTextField.innerText = "The year range is too large!";
          return;
        }

        // Empty array to populate with results
        let resultsList = [];

        // Iterate over the desired inclusive range of years
        for (i = submittedStartYear; i <= submittedEndYear; i++) {
          // Set hidden Islamic date values
          // The month and day are reset each time, since they can fluctuate
          document.islamic.year.value = i;
          document.islamic.month.selectedIndex = submittedMonthIndex;
          document.islamic.day.value = submittedDay;

          // Now that the hidden date is set, run the big calc function
          calcIslamic();

          // Make sure the hidden month and day haven't been changed
          // I'm not 100% sure this works
          if (
            document.islamic.month.selectedIndex === submittedMonthIndex &&
            document.islamic.day.value === submittedDay
          ) {
            // If calculated weekday == submitted weekday
            if (document.gregorian.wday.value === submittedWeekday) {
              // Push the year to the results array
              resultsList.push(i);
            }
          }
        }

        // Display results, if any
        if (resultsList.length > 0) {
          newResultsTextField.innerText = resultsList.join(", ");
        } else {
          newResultsTextField.innerText = "No matches were found.";
        }
      }

      // Function to clear all fields
      function newReset() {
        newMonthField.selectedIndex = 0;
        newDayField.value = "";
        newStartYearField.value = "";
        newEndYearField.value = "";
        newWeekdayField.selectedIndex = 0;
        newResultsTextField.innerText = "…";
      }

      // Event listeners for new functions
      newSubmitButton.addEventListener("click", experimentalSearch);
      newResetButton.addEventListener("click", newReset);
    </script>
  </body>
</html>
